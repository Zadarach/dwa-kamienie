{% extends "base.html" %}
{% block title %}Przedmioty{% endblock %}
{% block page_title %}Znalezione przedmioty{% endblock %}

{% block content %}
<!-- Filtry -->
<div class="card mb-3">
  <div class="card-body py-2">
    <form method="GET" class="row g-2 align-items-center">
      <div class="col-auto">
        <select name="query_id" class="form-select form-select-sm" onchange="this.form.submit()">
          <option value="">Wszystkie zapytania</option>
          {% for q in queries %}
          <option value="{{ q.id }}" {{ 'selected' if selected_query == q.id else '' }}>
            {{ q.name }} (#{{ q.channel_name }})
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-auto">
        <select name="limit" class="form-select form-select-sm" onchange="this.form.submit()">
          {% for l in [50, 100, 200, 500] %}
          <option value="{{ l }}" {{ 'selected' if limit == l else '' }}>{{ l }} wynik√≥w</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-auto ms-auto text-muted" style="font-size:.8rem">
        Pokazuje {{ items | length }} przedmiot√≥w
      </div>
    </form>
  </div>
</div>

<!-- Items grid -->
{% if items %}
<div class="row g-3">
  {% for item in items %}
  <div class="col-sm-6 col-lg-4 col-xl-3">
    <div class="card h-100">
      <!-- Zdjƒôcie -->
      <div style="height:180px;background:#1a1d27;border-radius:12px 12px 0 0;overflow:hidden;position:relative">
        {% if item.photo_url %}
        <img src="{{ item.photo_url }}" alt="{{ item.title }}"
             style="width:100%;height:100%;object-fit:cover"
             onerror="this.parentElement.innerHTML='<div style=\'display:flex;align-items:center;justify-content:center;height:100%;color:#8891a8;font-size:2.5rem\'>üè∑Ô∏è</div>'">
        {% else %}
        <div style="display:flex;align-items:center;justify-content:center;height:100%;color:#8891a8;font-size:2.5rem">üè∑Ô∏è</div>
        {% endif %}

        <!-- Kana≈Ç -->
        <div style="position:absolute;top:8px;right:8px">
          <span style="background:rgba(0,0,0,.65);color:#b39dff;font-size:.65rem;padding:2px 8px;border-radius:20px;backdrop-filter:blur(4px)">
            #{{ item.channel_name or item.query_name or '‚Äî' }}
          </span>
        </div>
      </div>

      <div class="card-body p-3">
        <h6 class="fw-semibold mb-1" style="font-size:.88rem;line-height:1.3">
          <a href="{{ item.item_url }}" target="_blank" class="text-light text-decoration-none">
            {{ item.title | truncate(50) }}
          </a>
        </h6>
        <div class="text-muted mb-2" style="font-size:.78rem">{{ item.brand or '‚Äî' }}</div>

        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="fw-bold" style="color:var(--accent-alt);font-size:1.05rem">
            {{ item.price }} {{ item.currency }}
          </span>
          <span class="badge" style="background:rgba(255,255,255,.06);color:#b0b8d0;font-size:.7rem">
            {{ item.size or '‚Äî' }}
          </span>
        </div>

        <div style="font-size:.73rem;color:var(--text-muted)">
          <span class="me-2">‚ú® {{ item.status or '‚Äî' }}</span>
        </div>
      </div>

      <div class="card-footer py-2 px-3 d-flex justify-content-between align-items-center"
           style="font-size:.72rem;color:var(--text-muted)">
        <span><i class="bi bi-clock me-1"></i>{{ item.sent_at[:16] if item.sent_at else '‚Äî' }}</span>
        <a href="{{ item.item_url }}" target="_blank" class="btn btn-sm btn-outline-secondary py-0 px-2"
           style="font-size:.72rem">
          Vinted <i class="bi bi-box-arrow-up-right ms-1"></i>
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% else %}
<div class="card">
  <div class="card-body text-center py-5">
    <div style="font-size:3rem;margin-bottom:1rem">üõçÔ∏è</div>
    <h5>Brak przedmiot√≥w</h5>
    <p class="text-muted">
      {% if selected_query %}
      Brak przedmiot√≥w dla wybranego zapytania.
      {% else %}
      Bot jeszcze nie znalaz≈Ç ≈ºadnych przedmiot√≥w. Sprawd≈∫ czy zapytania sƒÖ aktywne.
      {% endif %}
    </p>
    <a href="{{ url_for('queries') }}" class="btn btn-accent mt-2">ZarzƒÖdzaj zapytaniami</a>
  </div>
</div>
{% endif %}
{% endblock %}
